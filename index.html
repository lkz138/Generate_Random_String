<!DOCTYPE html>
<html lang="ja" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <title></title>
    <style media="screen">
      html>body{
        background-color: silver;
      }
      body>div:first-child{
        width: 100%;
      }
      table td, table th{
        text-align: center;
      }
      table td ol{
        text-align: left;
        list-style-type: none;
        padding-left: 0;
      }
      table textarea{
        resize: both;
      }
    </style>
    <script type="text/javascript">
      if (location.search != '') {
        location.replace( location.origin + location.pathname );
      }
    </script>
    <script type="text/javascript">
      function issueApi(){
        document.requestApi.apiResult.value='';
        $.ajax({
          url: './api/',
          data: {
            len: document.requestApi.apiLength.value,
            chr: document.requestApi.apiChk.value,
          }
        })
        .done(function(data){
          console.log(data);
          document.requestApi.apiResult.value=data.string;
          navigator.clipboard.writeText( data.string );

          /* Get the legend */
          $.ajax({
            url: '../GetStrLegend/check/',
            type: 'post',
            data: {
              textdata: data.string,
            }
          })
          .done(function(data){
            $('#legendlist').empty();
            (data.data).forEach((item, i) => {
              $('#legendlist').append('<tr><td>' + item[0] + '</td><td>' + item[1] + '</td></tr>')
            });

          })
          .fail(function(data){
            console.log(data);
          });


        })
        .fail(function(data){
          console.log(data);
          alert('Error\nCannot connect to server.');
        })
        .always(function(data){
          $('table+p span').text(location.origin + location.pathname + 'api/' + '?len=' + document.requestApi.apiLength.value + '&chr=' + document.requestApi.apiChk.value);
        });
      }
      $(function(){
        issueApi();

        $('[name=apiResult]').click(function(){
          $(this).select();
          navigator.clipboard.writeText( $(this).val() );
        });

        $('[name=apiLenBar]').change(function(){
          document.requestApi.apiLength.value=$(this).val();
          issueApi();
        });

        $('[name=apiLength]').change(function(){
          document.requestApi.apiLenBar.value=$(this).val();
          issueApi();
        });

        $('[name=apiChkL]').change(function(){
          document.requestApi.apiChk.value = '';
          if ( document.requestApi.apiChkL.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + 'a'; }
          if ( document.requestApi.apiChkU.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + 'A'; }
          if ( document.requestApi.apiChkN.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + '1'; }
          if ( document.requestApi.apiChkS.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + '@'; }
          issueApi();
        });

        $('[name=apiChkU]').change(function(){
          document.requestApi.apiChk.value = '';
          if ( document.requestApi.apiChkL.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + 'a'; }
          if ( document.requestApi.apiChkU.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + 'A'; }
          if ( document.requestApi.apiChkN.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + '1'; }
          if ( document.requestApi.apiChkS.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + '@'; }
          issueApi();
        });

        $('[name=apiChkN]').change(function(){
          document.requestApi.apiChk.value = '';
          if ( document.requestApi.apiChkL.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + 'a'; }
          if ( document.requestApi.apiChkU.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + 'A'; }
          if ( document.requestApi.apiChkN.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + '1'; }
          if ( document.requestApi.apiChkS.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + '@'; }
          issueApi();
        });

        $('[name=apiChkS]').change(function(){
          document.requestApi.apiChk.value = '';
          if ( document.requestApi.apiChkL.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + 'a'; }
          if ( document.requestApi.apiChkU.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + 'A'; }
          if ( document.requestApi.apiChkN.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + '1'; }
          if ( document.requestApi.apiChkS.checked ) { document.requestApi.apiChk.value = document.requestApi.apiChk.value + '@'; }
          issueApi();
        });

      });
    </script>
  </head>
  <body>
    <div>
      <form action="" name="requestApi">
        <table border="1">
          <tr>
            <th>Character</th>
            <th>Length</th>
            <th>Results</th>
          </tr>
          <tr>
            <td>
              <input type="hidden" name="apiChk" value="aA1@">
              <ol>
                <li><label><input type="checkbox" checked name="apiChkL" value="a">英小字</label></li>
                <li><label><input type="checkbox" checked name="apiChkU" value="A">英大字</label></li>
                <li><label><input type="checkbox" checked name="apiChkN" value="1">数字</label></li>
                <li><label><input type="checkbox" checked name="apiChkS" value="@">記号</label></li>
              </ol>
            </td>
            <td>
              <input type="range" name="apiLenBar" value="8" min="6" max="128"><br />
              <input type="number" name="apiLength" value="8" min="6" max="192">
            </td>
            <td><textarea name="apiResult" readonly></textarea></td>
          </tr>
        </table>
        <p>[API/GET] <span></span></p>
        <table border="1" id="legendlist"></table>
      </form>
    </div>
  </body>
</html>
